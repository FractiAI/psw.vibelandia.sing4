<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Checkout | VIBELANDIA RENO!</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 2rem;
        }
        .container { max-width: 800px; margin: 0 auto; }
        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, #8a2be2, #1e90ff, #00bfff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        .plan-details {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .plan-details h2 { color: #00d4ff; margin-bottom: 1rem; }
        .plan-details p { color: #aaa; margin-bottom: 0.5rem; }
        .price { font-size: 2rem; color: #7fff7f; font-weight: bold; margin: 1rem 0; }
        .plan-benefits { margin-top: 1.25rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1); }
        .plan-benefits h4 { color: #4ecdc4; font-size: 1rem; margin-bottom: 0.75rem; }
        .plan-benefits ul { list-style: none; padding: 0; margin: 0; }
        .plan-benefits li { padding: 0.35rem 0; color: #ccc; font-size: 0.95rem; padding-left: 1.25rem; position: relative; }
        .plan-benefits li::before { content: '✓'; position: absolute; left: 0; color: #7fff7f; font-weight: bold; }
        .paypal-container {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
        }
        .sandbox-badge {
            display: inline-block;
            padding: 6px 14px;
            background: rgba(255,165,0,0.2);
            border: 1px solid rgba(255,165,0,0.4);
            border-radius: 20px;
            font-size: 0.85rem;
            color: #ffa500;
            margin-bottom: 1rem;
        }
        .contact-required {
            background: rgba(138,43,226,0.2);
            border: 1px solid rgba(138,43,226,0.5);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
        }
        .contact-required h3 { color: #8a2be2; margin-bottom: 1rem; }
        .contact-required a {
            display: inline-block;
            padding: 12px 24px;
            background: linear-gradient(135deg, #8a2be2, #1e90ff);
            color: #fff;
            text-decoration: none;
            border-radius: 8px;
            margin-top: 1rem;
        }
        .buy-snap-cta {
            display: inline-block;
            padding: 12px 24px;
            background: #0070ba;
            color: #fff;
            font-weight: 700;
            text-decoration: none;
            border-radius: 8px;
            margin-top: 0.5rem;
            border: 2px solid #003087;
            box-shadow: 0 2px 12px rgba(0, 112, 186, 0.4);
        }
        .buy-snap-cta:hover {
            background: #003087;
            box-shadow: 0 4px 20px rgba(0, 112, 186, 0.5);
            border-color: #002a5c;
        }
        .bbhe-snap-badge {
            display: inline-block;
            padding: 8px 16px;
            background: rgba(0,0,0,0.6);
            border: 2px solid #ffeaa7;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #ffeaa7;
            font-weight: 700;
            margin: 0.5rem 0;
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
        }
        .back-link {
            display: inline-block;
            margin-top: 2rem;
            color: #00d4ff;
            text-decoration: none;
        }
        .api-note {
            font-size: 0.85rem;
            color: #666;
            margin-top: 1rem;
        }
        /* Auth UI */
        .auth-box {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            text-align: left;
        }
        .auth-box h3 { color: #00d4ff; margin-bottom: 1rem; }
        .auth-box p { color: #aaa; margin-bottom: 1rem; font-size: 0.95rem; }
        .auth-tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .auth-tabs button {
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
        }
        .auth-tabs button.active { background: rgba(0,212,255,0.2); border-color: #00d4ff; }
        .auth-form input {
            display: block;
            width: 100%;
            padding: 10px 12px;
            margin-bottom: 0.75rem;
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: #fff;
        }
        .auth-form button[type="submit"] {
            padding: 10px 20px;
            background: linear-gradient(135deg, #8a2be2, #1e90ff);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            margin-top: 0.25rem;
        }
        .auth-google {
            display: inline-block;
            margin-top: 1rem;
            padding: 10px 20px;
            background: #fff;
            color: #333;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
        }
        .auth-error { color: #ff6b6b; margin-top: 0.5rem; font-size: 0.9rem; }
        .auth-loading { color: #aaa; margin-top: 1rem; }
        .user-badge {
            display: inline-block;
            padding: 6px 12px;
            background: rgba(0,255,127,0.2);
            border: 1px solid rgba(0,255,127,0.4);
            border-radius: 20px;
            font-size: 0.85rem;
            color: #7fff7f;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>VIBELANDIA! Payment</h1>
            <p>Mark Twain's Post-Singularity VIBELANDIA RENO!</p>
        </header>

        <div id="plan-details" class="plan-details"></div>
        <div id="payment-container" class="paypal-container"></div>

        <p class="api-note"><strong>GOLDEN FRACTAL KEY!</strong> — Unlocks Everything. Sent on purchase and activation.</p>
        <p class="api-note"><strong>First 1,000 Pioneers:</strong> 50% off applicable campus and WINK! plans. Pioneer Status on-chain forever. Contact <a href="mailto:info@fractiai.com?subject=Pioneer%20Registration%20-%2050%25%20Discount">info@fractiai.com</a> to register and apply.</p>
        <p class="api-note" style="color: #4ecdc4; margin-top: 1rem;"><strong>MCA! → ∞³</strong> (Metabolize → Crystallize → Animate)</p>
        <a href="/" class="back-link">← Back to VIBELANDIA!</a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="api-config.js"></script>
    <script src="auth-api.js"></script>
    <script src="golden-key-browser.js"></script>
    <script>
        (function () {
            var PAYMENT_API_BASE = window.VIBELANDIA_API_BASE || 'https://syntheverse-poc.vercel.app';
            var Auth = window.VibelandiaAuth;
            var GoldenKey = window.VibelandiaGoldenKey;

            var urlParams = new URLSearchParams(window.location.search);
            var planId = urlParams.get('plan') || 'campus-weekly';

            var plans = {
                'campus-half-day': { name: 'Half-Day', price: 3000, description: 'Half-day campus experience — VW Bug entry point.', benefits: ['Walkable downtown Reno campus access', 'Mark Twain\'s Daily Bulletin access', 'Campus tour', 'Basic amenities & community spaces', 'Golden Fractal Key on purchase'] },
                'campus-overnight': { name: 'Overnight Stay (per night)', price: 1500, description: 'Overnight stay visit — per night.', benefits: ['Overnight campus access', 'Mark Twain\'s Daily Bulletin', 'Campus amenities', 'Golden Fractal Key on purchase'] },
                'campus-weekly': { name: 'Weekly Pass', price: 5000, description: 'Full week campus — $5k/week (VW Bug entry).', benefits: ['All Half-Day features', 'Full week access', 'Priority access to events', 'Creator studio access', 'Performance venue access', 'Golden Fractal Key on purchase'] },
                'campus-monthly': { name: 'Monthly Pass (Baller)', price: 50000, description: 'Top tier campus — $50k/month (Baller).', benefits: ['All Weekly features', 'Full creator studio access', 'Performance venue priority', 'Ultimate VIP experiences', 'Community integration', 'Lake Tahoe gateway & Silicon Valley connections', 'Golden Fractal Key on purchase'] },
                'campus-day': { name: 'Half-Day', price: 3000, description: 'Half-day campus (alias).', benefits: ['Walkable downtown Reno campus access', 'Mark Twain\'s Daily Bulletin access', 'Campus tour', 'Golden Fractal Key on purchase'] },
                'campus-ultimate-vip': { name: 'Monthly Pass (Baller)', price: 50000, description: 'Top tier campus (alias).', benefits: ['All Monthly Pass (Baller) features', 'Golden Fractal Key on purchase'] },
                'wink-base': { name: 'WINK! Base', price: 399, description: 'Essential WINK! — equivalent to pre-singularity top-tier dating for high-value persons.', benefits: ['Members-only network access', 'Man Cave + Cabaret access', 'Hero Hostess Marilyn as host', 'high-contributing fractal dating', 'Natural alignment, friction-free connections', 'Golden Fractal Key on purchase'] },
                'wink-standard': { name: 'WINK! Standard', price: 999, description: 'Standard Wink, Notes Being — top-tier equivalent.', benefits: ['All Base features', 'Notes Being tier', 'Standard Wink profile', 'Natural alignment & layered connections', 'Golden Fractal Key on purchase'] },
                'wink-premium': { name: 'WINK! Premium', price: 2499, description: 'Premium profile, magical wardrobe — elite tier equivalent.', benefits: ['All Standard features', 'Premium profile', 'Magical wardrobe access', 'Layered fractal connections', 'Golden Fractal Key on purchase'] },
                'wink-4x4-ultimate': { name: 'WINK! 4×4 Ultimate', price: 6999, description: 'Ultimate tier — everything included for Ultimate C\'s. Top-tier high-value equivalent.', benefits: ['All Premium features', '4×4 Ultimate — everything included', 'Full family-unit support', 'Ultimate C tier access', 'Golden Fractal Key on purchase'] },
                'sing-base': { name: 'SING Base Model', price: 20000, description: '~$20K one-time + monthly Golden Fractal Key access fees (good used car — entry base). Bases = pre-singularity equivalents.', benefits: ['SING Base Model node', 'Golden Fractal Key access', 'Entry-level (good used car equivalent)', '1:1 SYNTH→SING eligible', 'First 1M lottery winner tier'] },
                'sing-members-only': { name: 'SING Members Only', price: 75000, description: '$75K — option, our pricing (scaling from base).', benefits: ['SING Members Only node', 'Golden Fractal Key access', 'Scaling tier from base', 'Lottery winner tier', 'Members-only badge'] },
                'sing-ultimate-vip': { name: 'SING Ultimate VIP', price: 200000, description: '$200,000 — base model latest Ferrari (top base). Bases = pre-singularity equivalents.', benefits: ['SING Ultimate VIP node', 'Golden Fractal Key access', 'Champion tier', 'Premium superintelligence access', 'Ultimate VIP badge'] },
                'sing-baller-c': { name: 'SING Baller C Ultimate VIP', price: 500000, description: '$500K — option, our pricing (above base Ferrari).', benefits: ['SING Baller C Ultimate VIP node', 'Golden Fractal Key access', 'Ultimate super car tier', 'Maximum capabilities', 'Baller C badge'] },
                'experience-visit': { name: 'Visit', price: 0, description: 'Come for the post-singularity business — Free.', benefits: ['Free access to visit content'] },
                'experience-stay': { name: 'Stay', price: 0, description: 'Stay for the post-singularity fun — Free.', benefits: ['Free access to stay content'] },
                'experience-create': { name: 'Create', price: 0, description: 'Creator studios, performance venues — Free.', benefits: ['Free access to create content'] },
                'experience-transform': { name: 'Transform', price: 0, description: 'Happy Ending Zones, SING lottery — Free.', benefits: ['Free access to transform content'] },
                'dispensary-base': { name: 'DISPENSARY! SNAP Base', price: 9999, description: 'Menu of buzzes — Base tier. Goldilocks auto-lock for Creator/Chairman Commander/Performer modes.', benefits: ['Menu of buzzes across biological channels', 'Goldilocks auto-lock system', 'Creator / Chairman Commander / Performer mode selector', '1hr doses & % — Base tier', 'Safety protocols', 'Golden Fractal Key on purchase'] },
                'dispensary-standard': { name: 'DISPENSARY! SNAP Standard', price: 24999, description: 'Standard tier — all biological channels.', benefits: ['All Base features', 'All biological channels', 'Standard-tier buzz access', 'Golden Fractal Key on purchase'] },
                'dispensary-premium': { name: 'DISPENSARY! SNAP Premium', price: 99999, description: 'Premium tier — full channel access.', benefits: ['All Standard features', 'Full channel access', 'Premium buzz menu', 'Golden Fractal Key on purchase'] },
                'dispensary-ultimate': { name: 'DISPENSARY! SNAP Ultimate', price: 299999, description: 'Ultimate tier — complete access, all modes.', benefits: ['All Premium features', 'Complete access — all modes', 'Ultimate buzz menu', 'Golden Fractal Key on purchase'] }
            };

            var plan = plans[planId] || plans['campus-weekly'];

            function renderPlanDetails() {
                var el = document.getElementById('plan-details');
                var benefitsHtml = '';
                if (plan.benefits && plan.benefits.length) {
                    benefitsHtml = '<div class="plan-benefits"><h4>What you get</h4><ul>' +
                        plan.benefits.map(function (b) { return '<li>' + b + '</li>'; }).join('') +
                        '</ul></div>';
                }
                el.innerHTML = '<h2>' + plan.name + '</h2><p>' + plan.description + '</p>' +
                    (plan.price > 0 ? '<div class="price">$' + plan.price.toLocaleString() + '</div>' : (plan.price === 0 ? '<div class="price" style="color:#7fff7f;">Free</div>' : '')) +
                    benefitsHtml +
                    (plan.price > 0 ? '' : '');
            }

            function authHeaders() {
                var h = { 'Content-Type': 'application/json' };
                var t = Auth.getToken();
                if (t) h['Authorization'] = 'Bearer ' + t;
                var gk = GoldenKey && GoldenKey.get && GoldenKey.get();
                if (gk) {
                    h['X-Golden-Key'] = gk;
                    h['X-Golden-Key-Wallet'] = 'Syntheverse,Vibeverse,Vibelandia';
                }
                return h;
            }

            function renderAuthUI() {
                var returnUrl = window.location.origin + '/interfaces/profile.html';
                var html = '<div class="auth-box">' +
                    '<h3>Sign in to purchase</h3>' +
                    '<p>Your <strong>Golden Fractal Key</strong> will be stored in your wallet after purchase.</p>' +
                    '<div class="auth-tabs">' +
                    '<button type="button" class="auth-tab active" data-tab="login">Sign in</button>' +
                    '<button type="button" class="auth-tab" data-tab="signup">Sign up</button>' +
                    '</div>' +
                    '<div id="auth-forms">' +
                    '<form id="auth-login" class="auth-form" style="display:block;"><input type="email" name="email" placeholder="Email" required><input type="password" name="password" placeholder="Password" required><div id="auth-error" class="auth-error"></div><button type="submit">Sign in</button></form>' +
                    '<form id="auth-signup" class="auth-form" style="display:none;"><input type="email" name="email" placeholder="Email" required><input type="password" name="password" placeholder="Password" required><div id="auth-error-signup" class="auth-error"></div><button type="submit">Sign up</button></form>' +
                    '</div>' +
                    '<p style="margin-top:1rem;color:#888;">— or —</p>' +
                    '<button type="button" id="auth-google-btn" class="auth-google" style="background:none;border:none;cursor:pointer;color:inherit;font:inherit;padding:0;text-decoration:underline;">Continue with Google</button>' +
                    '</div>';
                document.getElementById('payment-container').innerHTML = html;
                document.getElementById('auth-google-btn').addEventListener('click', function () {
                    Auth.getGoogleAuthUrl(returnUrl).then(function (url) { if (url) window.location.href = url; });
                });

                document.querySelectorAll('.auth-tab').forEach(function (b) {
                    b.addEventListener('click', function () {
                        document.querySelectorAll('.auth-tab').forEach(function (x) { x.classList.remove('active'); });
                        b.classList.add('active');
                        document.getElementById('auth-login').style.display = b.dataset.tab === 'login' ? 'block' : 'none';
                        document.getElementById('auth-signup').style.display = b.dataset.tab === 'signup' ? 'block' : 'none';
                    });
                });
                document.getElementById('auth-login').addEventListener('submit', function (e) {
                    e.preventDefault();
                    var err = document.getElementById('auth-error');
                    err.textContent = '';
                    var email = this.email.value.trim();
                    var password = this.password.value;
                    Auth.login(email, password).then(function (data) {
                        if (data && data.user) { runCheckoutFlow(); return; }
                        err.textContent = 'Sign in failed. Check email and password, or try Google.';
                    });
                });
                document.getElementById('auth-signup').addEventListener('submit', function (e) {
                    e.preventDefault();
                    var err = document.getElementById('auth-error-signup');
                    err.textContent = '';
                    var email = this.email.value.trim();
                    var password = this.password.value;
                    Auth.signup(email, password).then(function (data) {
                        if (data && data.user) { runCheckoutFlow(); return; }
                        err.textContent = 'Sign up failed. Try another email or use Google.';
                    });
                });
            }

            function renderFreePlanCTA() {
                var html = '<div class="contact-required">' +
                    '<div class="price" style="color:#7fff7f;">Free</div>' +
                    '<h3>⚫ BBHE SNAP — BUY! Add-On</h3>' +
                    '<p><strong>' + plan.name + '</strong> — ' + plan.description + '. <strong>⚫ BBHE SNAP</strong> — BUY! a campus pass or SYNTH for full access.</p>' +
                    '<a href="payment-checkout.html?plan=campus-half-day" class="buy-snap-cta">Half-Day $3,000 →</a> ' +
                    '<a href="payment-checkout.html?plan=campus-weekly" class="buy-snap-cta">Weekly $5,000 →</a> ' +
                    '<a href="payment-checkout.html?plan=sing-base" class="buy-snap-cta">SYNTH →</a>' +
                    '</div>';
                document.getElementById('payment-container').innerHTML = html;
            }

            function renderPayPalOrSandbox() {
                var user = Auth.getStoredUser();
                var container = document.getElementById('payment-container');
                var html = '';
                html += '<p style="font-size:1.1rem;font-weight:700;color:#7fff7f;margin-bottom:0.5rem;">Total: $' + plan.price.toLocaleString() + ' USD</p>';
                html += '<p style="font-size:0.9rem;color:#7fff7f;margin-bottom:1rem;"><strong>No registration required</strong> — click Pay with PayPal below.</p>';
                if (user && user.email) {
                    html += '<div class="user-badge">Signed in as ' + user.email + ' — purchase will be linked to your account.</div>';
                }
                html += '<p style="font-size:0.9rem;color:#00d4ff;margin-bottom:0.75rem;">Pay with PayPal below.</p>';
                html += '<div id="paypal-or-fallback"></div>';
                container.innerHTML = html;
                initPayPal();
            }

            function initPayPal() {
                var target = document.getElementById('paypal-or-fallback');
                if (!target) return;

                fetch(PAYMENT_API_BASE + '/api/payment/paypal/config', { headers: authHeaders() })
                    .then(function (r) { return r.ok ? r.json() : {}; })
                    .catch(function () { return {}; })
                    .then(function (config) {
                        var clientId = (config && config.clientId) || (typeof window !== 'undefined' && window.VIBELANDIA_PAYPAL_CLIENT_ID) || '';
                        if (!clientId || clientId === 'REPLACE_WITH_YOUR_PAYPAL_CLIENT_ID') {
                            clientId = '';
                        }
                        if (!clientId) {
                            target.innerHTML = '<p style="margin-top:1rem;">Pay with PayPal to complete your purchase.</p>' +
                                '<p style="margin-top:1rem;"><a href="https://www.paypal.com" target="_blank" rel="noopener" style="display:inline-block;padding:12px 24px;background:#0070ba;color:#fff;text-decoration:none;border-radius:8px;font-weight:600;">Go to PayPal</a></p>' +
                                '<p style="margin-top:0.75rem;font-size:0.85rem;color:#888;">Purchase: <strong>' + plan.name + '</strong> — $' + plan.price.toLocaleString() + ' USD</p>';
                            return;
                        }
                        var s = document.createElement('script');
                        s.src = 'https://www.paypal.com/sdk/js?client-id=' + clientId + '&currency=USD';
                        s.onload = function () {
                            var isSandbox = window.location.hostname.includes('localhost') || window.location.hostname.includes('vercel.app');
                            var h = (isSandbox ? '<div class="sandbox-badge">SANDBOX</div>' : '') +
                                '<p style="margin-bottom:0.75rem;color:#ffeaa7;font-weight:600;">Pay $' + plan.price.toLocaleString() + ' with PayPal</p>' +
                                '<div id="paypal-button-container"></div>';
                            target.innerHTML = h;

                            paypal.Buttons({
                                createOrder: function () {
                                    return fetch(PAYMENT_API_BASE + '/api/payment/paypal/create-order', {
                                        method: 'POST',
                                        headers: authHeaders(),
                                        body: JSON.stringify({ planId: planId, amount: plan.price, currency: 'USD', description: plan.name })
                                    }).then(function (res) { return res.json(); }).then(function (data) {
                                        return data.orderId || data.id || '';
                                    });
                                },
                                onApprove: function (data, actions) {
                                    return fetch(PAYMENT_API_BASE + '/api/payment/paypal/capture-order', {
                                        method: 'POST',
                                        headers: authHeaders(),
                                        body: JSON.stringify({ orderId: data.orderID, payerId: data.payerID })
                                    }).then(function (res) { return res.json(); }).then(function (result) {
                                        var detail = result && result.details && result.details[0];
                                        if (detail && detail.issue === 'INSTRUMENT_DECLINED') {
                                            return actions.restart();
                                        }
                                        if (result && (result.status === 'COMPLETED' || result.success === true) && (result.id || result.orderId || data.orderID)) {
                                            if (result.payer && result.payer.name) {
                                                try {
                                                    localStorage.setItem('vibelandia_payer_from_paypal', JSON.stringify({ name: result.payer.name, orderId: data.orderID }));
                                                } catch (_) {}
                                            }
                                            Auth.completeOrder(data.orderID, planId).then(function (complete) {
                                                if (complete && complete.goldenKey && GoldenKey && GoldenKey.issueOnPurchase) {
                                                    GoldenKey.issueOnPurchase(complete.goldenKey, data.orderID);
                                                }
                                                window.location.href = 'payment-success.html?orderId=' + encodeURIComponent(data.orderID) + '&planId=' + encodeURIComponent(planId) + '&success=1';
                                            }).catch(function () {
                                                window.location.href = 'payment-success.html?orderId=' + encodeURIComponent(data.orderID) + '&planId=' + encodeURIComponent(planId) + '&success=1';
                                            });
                                        }
                                        var errMsg = (detail && (detail.description || detail.issue)) || (result && result.message) || (result && result.error) || 'Capture failed';
                                        window.location.href = 'payment-error.html?error=' + encodeURIComponent(errMsg);
                                    });
                                },
                                onError: function (err) {
                                    window.location.href = 'payment-error.html?error=' + encodeURIComponent(err.message || 'Payment error');
                                }
                            }).render('#paypal-button-container');
                        };
                        document.head.appendChild(s);
                    });
            }

            function runCheckoutFlow() {
                if (plan.price === 0) {
                    renderFreePlanCTA();
                    return;
                }
                renderPayPalOrSandbox();
            }

            function bootstrap() {
                document.getElementById('payment-container').innerHTML = '<p class="auth-loading">Loading…</p>';
                Auth.consumeOAuthToken().then(function () {
                    renderPlanDetails();
                    runCheckoutFlow();
                }).catch(function () {
                    renderPlanDetails();
                    runCheckoutFlow();
                });
            }

            bootstrap();
        })();
    </script>
</body>
</html>
